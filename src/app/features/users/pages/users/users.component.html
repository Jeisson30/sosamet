<div class="user-card">
  <h2 class="login-title">Gestión de Usuarios</h2>

  <div class="form-grid">
    <p-floatlabel class="form-field">
      <input id="nombre" pInputText [(ngModel)]="nombre" />
      <label for="nombre">Nombres</label>
    </p-floatlabel>

    <p-floatlabel class="form-field">
      <input id="apellidos" pInputText [(ngModel)]="apellidos" />
      <label for="apellidos">Apellidos</label>
    </p-floatlabel>

    <p-floatlabel class="form-field">
      <input id="identificacion" pInputText [(ngModel)]="identificacion" />
      <label for="identificacion">Identificación</label>
    </p-floatlabel>

    <p-floatlabel class="form-field">
      <input id="correo" pInputText [(ngModel)]="correo" />
      <label for="correo">Correo electrónico</label>
    </p-floatlabel>

    <p-floatlabel class="form-field">
      <p-dropdown
        [options]="roles"
        optionLabel="perfil"
        optionValue="id_perfil"
        [(ngModel)]="rolSeleccionado"
        [showClear]="true"
        placeholder="Selecciona un rol"
        class="w-full"
      ></p-dropdown>
    </p-floatlabel>
  </div>

  <div class="form-button-wrapper">
    <p-button
      label="Crear usuario"
      icon="pi pi-user-plus"
      (onClick)="createUser()"
      severity="primary"
      class="w-full"
    ></p-button>
  </div>

  <p-button
    label="Consultar Usuarios"
    icon="pi pi-search"
    (onClick)="getDataUsers()"
    severity="info"
    class="w-full mb-3"
  ></p-button>

  <p-table [value]="usuarios" responsiveLayout="scroll">
    <ng-template pTemplate="header">
      <tr>
        <th>Nombre</th>
        <th>Apelldos</th>
        <th>Identificación</th>
        <th>Correo</th>
        <th>Rol</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-usuario>
      <tr>
        <td>{{ usuario.nombre }}</td>
        <td>{{ usuario.apellido }}</td>
        <td>{{ usuario.identificacion }}</td>
        <td>{{ usuario.email }}</td>
        <td>{{ usuario.perfil }}</td>
        <td>{{ usuario.estado }}</td>
        <td>
          <p-button
            label="Editar"
            icon="pi pi-pencil"
            severity="success"
            size="small"
            class="mr-2"
            [rounded]="true"
            (onClick)="editarUsuario(usuario)"
          ></p-button>
          <p-button
            [label]="getLabelEstado(usuario)"
            icon="pi pi-trash"
            severity="info"
            size="small"
            class="ml-4"
            [rounded]="true"
            (onClick)="cambiarEstadoUsuario(usuario)"
          ></p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!--  MODAL Edicion usuario -->

  <p-dialog
    [(visible)]="mostrarDialogoEdicion"
    (onHide)="usuarioEditando = null"
    header="Editar usuario"
    [modal]="true"
    [style]="{ width: '90vw', maxWidth: '500px' }"
    [closable]="true"
    [baseZIndex]="10000"
  >
    <div *ngIf="usuarioEditando" class="form-grid">
      <p-floatLabel>
        <input
          id="nombre"
          type="text"
          pInputText
          [(ngModel)]="usuarioEditando.nombre"
          placeholder="Nombre"
        />
      </p-floatLabel>

      <p-floatLabel>
        <input
          id="apellido"
          type="text"
          pInputText
          [(ngModel)]="usuarioEditando.apellido"
          placeholder="Apellidos"
        />
      </p-floatLabel>

      <p-floatLabel>
        <input
          id="email"
          type="text"
          pInputText
          [(ngModel)]="usuarioEditando.email"
          placeholder="Correo"
        />
      </p-floatLabel>

      <p-floatLabel>
        <input
          id="identificacion"
          type="text"
          pInputText
          [(ngModel)]="usuarioEditando.identificacion"
          placeholder="Identificación"
        />
      </p-floatLabel>

      <p-dropdown
        [options]="roles"
        optionLabel="perfil"
        optionValue="id_perfil"
        [(ngModel)]="usuarioEditando.id_rol"
        placeholder="Seleccionar rol"
        class="full-width"
      ></p-dropdown>

      <div class="form-button-row">
        <button
          pButton
          label="Actualizar"
          (click)="actualizarUsuario()"
          class="p-button-success"
        ></button>
      </div>
    </div>
  </p-dialog>
</div>
