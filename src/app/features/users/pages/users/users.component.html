<div class="user-card">
  <h2 class="login-title">Usuarios</h2>

  <div class="form-grid">
    <p-floatlabel class="form-field">
      <input id="nombre" pInputText [(ngModel)]="nombre" />
      <label for="nombre">Nombres</label>
    </p-floatlabel>

    <p-floatlabel class="form-field">
      <input id="apellidos" pInputText [(ngModel)]="apellidos" />
      <label for="apellidos">Apellidos</label>
    </p-floatlabel>

    <p-floatlabel class="form-field">
      <input id="identificacion" pInputText [(ngModel)]="identificacion" />
      <label for="identificacion">Identificaci贸n</label>
    </p-floatlabel>

    <p-floatlabel class="form-field">
      <input id="correo" pInputText [(ngModel)]="correo" />
      <label for="correo">Correo electr贸nico</label>
    </p-floatlabel>

    <p-floatlabel class="form-field">
      <p-dropdown
        [options]="roles"
        optionLabel="perfil"
        optionValue="id_perfil"
        [(ngModel)]="rolSeleccionado"
        [showClear]="true"
        placeholder="Selecciona un rol"
        class="w-full"
      ></p-dropdown>
    </p-floatlabel>
  </div>

  <div class="form-button-row">
    <p-button
      label="CREAR"
      icon="pi pi-user-plus"
      (onClick)="createUser()"
      severity="primary"
      class="custom-btn"
    ></p-button>
  
    <p-button
      label="CONSULTAR"
      icon="pi pi-search"
      (onClick)="getDataUsers()"
      severity="info"
      class="custom-btn"
    ></p-button>
  </div>

  <p-table
    [value]="usuarios"
    [paginator]="true"
    [rows]="10"
    [rowsPerPageOptions]="[5, 10, 20, 50]"
    [globalFilterFields]="[
      'nombre',
      'apellido',
      'identificacion',
      'email',
      'perfil',
      'estado'
    ]"
    responsiveLayout="scroll"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Nombre</th>
        <th>Apelldos</th>
        <th>Identificaci贸n</th>
        <th>Correo</th>
        <th>Rol</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-usuario>
      <tr>
        <td>{{ usuario.nombre }}</td>
        <td>{{ usuario.apellido }}</td>
        <td>{{ usuario.identificacion }}</td>
        <td>{{ usuario.email }}</td>
        <td>{{ usuario.perfil }}</td>
        <td>{{ usuario.estado }}</td>
        <td>
          <p-button
            label="Editar"
            icon="pi pi-pencil"
            severity="success"
            size="small"
            class="custom-btn mr-2"
            [rounded]="true"
            (onClick)="editarUsuario(usuario)"
          ></p-button>
          <p-button
            [label]="getLabelEstado(usuario)"
            icon="pi pi-trash"
            severity="info"
            size="small"
            class="custom-btn ml-4"
            [rounded]="true"
            (onClick)="cambiarEstadoUsuario(usuario)"
          ></p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!--  MODAL Edicion usuario -->

  <p-dialog
    [(visible)]="mostrarDialogoEdicion"
    (onHide)="usuarioEditando = null"
    header="Editar usuario"
    [modal]="true"
    [style]="{ width: '90vw', maxWidth: '500px' }"
    [closable]="true"
    [baseZIndex]="10000"
  >
    <div *ngIf="usuarioEditando" class="form-grid">
      <p-floatLabel>
        <input
          id="nombre"
          type="text"
          pInputText
          [(ngModel)]="usuarioEditando.nombre"
          placeholder="Nombre"
        />
      </p-floatLabel>

      <p-floatLabel>
        <input
          id="apellido"
          type="text"
          pInputText
          [(ngModel)]="usuarioEditando.apellido"
          placeholder="Apellidos"
        />
      </p-floatLabel>

      <p-floatLabel>
        <input
          id="email"
          type="text"
          pInputText
          [(ngModel)]="usuarioEditando.email"
          placeholder="Correo"
        />
      </p-floatLabel>

      <p-floatLabel>
        <input
          id="identificacion"
          type="text"
          pInputText
          [(ngModel)]="usuarioEditando.identificacion"
          placeholder="Identificaci贸n"
          disabled
        />
      </p-floatLabel>

      <p-dropdown
        [options]="roles"
        optionLabel="perfil"
        optionValue="id_perfil"
        [(ngModel)]="usuarioEditando.id_rol"
        placeholder="Seleccionar rol"
        class="full-width"
      ></p-dropdown>

      <div class="form-button-row">
        <p-button
          label="ACTUALIZAR"
          (click)="actualizarUsuario()"
          class="custom-btn"
        ></p-button>
      </div>
    </div>
  </p-dialog>
</div>
